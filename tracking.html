<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Restaurant â€” Order Tracking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #FF6F61; /* Warm coral red */
      --secondary: #D4AF37; /* Soft gold */
      --light-bg: #FFF5F0;
      --card-bg: #ffffff;
      --status-inactive: #ccc;
      --status-active: var(--primary);
    }

    body { font-family: 'Roboto', sans-serif; background:var(--light-bg); color:#333; margin:0; padding:0; }
    .header { display:flex; justify-content:space-between; align-items:center; padding:20px 40px; background:var(--card-bg); box-shadow:0 3px 10px rgba(0,0,0,0.1); position:sticky; top:0; z-index:1000;}
    .brand { font-family:'Playfair Display', serif; font-size:1.8rem; color:var(--secondary); }
    .nav a button, .nav button { margin-left:15px; padding:8px 14px; border:none; background:var(--primary); color:#fff; border-radius:6px; cursor:pointer; font-weight:500; transition:0.3s; }
    .nav a button:hover, .nav button:hover { background:var(--secondary); }
    h1 { text-align:center; font-family:'Playfair Display', serif; color:var(--primary); margin:30px 0; }
    .tracking-container { max-width:800px; margin:0 auto 40px; padding:0 20px; }
    .order-card { background:var(--card-bg); padding:20px; margin-bottom:20px; border-radius:12px; box-shadow:0 6px 15px rgba(0,0,0,0.1); }
    .order-card h4 { margin-bottom:10px; font-family:'Playfair Display', serif; color:var(--primary);}
    .order-card ul { list-style:none; padding:0; margin:0 0 10px; }
    .order-card ul li { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #ccc; }
    .order-card strong { display:block; text-align:right; margin-top:10px; font-size:1.1rem; color:#222; }
    .order-status { display:flex; justify-content:flex-start; margin-top:15px; gap:10px; flex-wrap:wrap; }
    .status-step { padding:8px 14px; border-radius:20px; font-weight:500; font-size:0.95rem; color:#fff; background:var(--status-inactive); transition:0.3s; }
    .status-step.active { background:var(--status-active); }
    .no-orders { text-align:center; font-size:1.2rem; margin-top:50px; color:#555; }
  </style>
</head>
<body>

  <div class="header">
    <div class="brand">Smart Restaurant</div>
    <div class="nav">
      <a href="menu.html"><button>Menu</button></a>
      <a href="checkout.html"><button>Checkout</button></a>
      <button id="logoutBtn">Logout</button>
    </div>
  </div>

  <h1>Track Your Orders</h1>
  <div class="tracking-container" id="trackingContainer"></div>

  <script>
    const currentUser = localStorage.getItem("currentUser");
    if(!currentUser){ alert("Please login!"); window.location.href="login.html"; }

    const statusSteps = ["pending", "bar", "chef", "ready", "delivered"];

    function renderOrders() {
      const orders = JSON.parse(localStorage.getItem(currentUser+"_cart_history") || "[]");
      const container = document.getElementById('trackingContainer');
      container.innerHTML = '';

      if(orders.length === 0) {
        container.innerHTML = '<p class="no-orders">No current orders.</p>';
        return;
      }

      orders.forEach((order, idx) => {
        const card = document.createElement('div');
        card.className = 'order-card';

        // Items list
        let html = `<h4>Order ${idx+1}</h4><ul>`;
        order.forEach(item=>{
          html += `<li>${item.name} x ${item.qty} <span>Ksh ${item.qty*item.price}</span></li>`;
        });
        html += `</ul><strong>Total: Ksh ${order.reduce((sum,i)=>sum+i.qty*i.price,0)}</strong>`;

        // Status tracker
        html += '<div class="order-status">';
        const currentStatusIndex = statusSteps.indexOf(order.status || "pending");
        statusSteps.forEach((step, i)=>{
          html += `<span class="status-step ${i <= currentStatusIndex ? 'active' : ''}">${step}</span>`;
        });
        html += '</div>';

        card.innerHTML = html;
        container.appendChild(card);
      });
    }

    // Simulate status updates for demo purposes
    function autoUpdateStatus() {
      const orders = JSON.parse(localStorage.getItem(currentUser+"_cart_history") || "[]");
      let changed = false;
      orders.forEach(order => {
        const currentIndex = statusSteps.indexOf(order.status || "pending");
        if(currentIndex < statusSteps.length - 1) {
          order.status = statusSteps[currentIndex + 1];
          changed = true;
        }
      });
      if(changed) localStorage.setItem(currentUser+"_cart_history", JSON.stringify(orders));
    }

    renderOrders();
    setInterval(()=>{ autoUpdateStatus(); renderOrders(); }, 4000); // Update every 4s

    // Logout
    document.getElementById("logoutBtn").onclick = ()=>{
      localStorage.removeItem("currentUser");
      window.location.href="login.html";
    }
  </script>
</body>
</html>
